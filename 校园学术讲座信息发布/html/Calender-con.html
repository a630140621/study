<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
		<meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
		<title>title</title>
		<link rel="stylesheet" type="text/css" href="../css/api.css"/>
		<link rel="stylesheet" type="text/css" href="../css/activity.css" />
		<style>
			html, body {
				background-color: #f2f2f2;
			}
		</style>
	</head>
	<body>
		<p>
			今日讲座
		</p>
		<div id="activity">
			<script id="act-template" type="text/x-dot-template">
				{{ for(var i=0; i < it.length; i++) { }}
				<div class="item">
				<a tapmode="" onclick="openActDetail('{{=it[i].id}}');">
				<h2>{{=it[i].title}}</h2>
				<p>
				{{=it[i].summary}}
				</p>
				</a>
				</div>
				{{ } }}
			</script>
			<div id="act-content"></div>
		</div>
	</body>
	<script type="text/javascript" src="../script/api.js"></script>
	<script type="text/javascript">
		function openActDetail(did) {
			api.openWin({
				name : 'actDetail',
				url : 'actDetail.html',
				//		delay: 200,
				pageParam : {
					dataId : did
				}
			});
		}

		apiready = function() {
			var date = api.pageParam.date;
			api.setRefreshHeaderInfo({
				visible : true,
				// loadingImgae: 'wgt://image/refresh-white.png',
				bgColor : '#f2f2f2',
				textColor : '#4d4d4d',
				textDown : '下拉刷新...',
				textUp : '松开刷新...',
				showTime : true
			}, function(ret, err) {
				api.refreshHeaderLoadDone();
			});
			api.showProgress({
				title : '加载中...',
				modal : false
			});
			var urlParam = {}, whereParam = {};
			whereParam['actDate'] = date;
			urlParam['where'] = whereParam;
			var getActivityByIdUrl = '/activity?filter=';
			ajaxRequest(getActivityByIdUrl + JSON.stringify(urlParam), 'GET', '', function(ret, err) {
				if (ret) {
					var content = $api.byId('act-content');
					var tpl = $api.byId('act-template').text;
					var tempFn = doT.template(tpl);
					content.innerHTML = tempFn(ret);
				} else {
					api.toast({
						msg : "今天暂无讲座"
					});
				}
				api.hideProgress();
			});
		};
	</script>
	<script type="text/javascript" src="../script/doT.min.js"></script>
	<script type="text/javascript" src="../script/common.js"></script>
</html>