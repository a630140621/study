<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="initial-scale=1.0,maximum-scale=1.0,minimum-scale=1.0,user-scalable=0, width=device-width"/>
		<title>api</title>
		<link rel="stylesheet" type="text/css" href="../css/api.css" />
		<link rel="stylesheet" type="text/css" href="../css/common.css" />
		<link rel="stylesheet" type="text/css" href="../css/actDetail.css" />
		<link rel="stylesheet" type="text/css" href="../css/activity.css" />
		<style type="text/css">
			html, body {
				/*background-color: transparent;*/
			}
			#header h1
			{
				padding-top: 20px;
				font-size: 24px;
			}
			input {
				border: 1px solid #000000;
				float: left;
				height: 20px;
				width: 80%;
			}
			#searchBox {
				margin:10px 0px 0px 10px;
				height:20px;
			}
		</style>
	</head>
	<body>
		<div id="wrap">
			<div id="main">
				<div id="header">
					<!-- <a class="back-icon" tapmode="" onclick="api.closeWin()">返回</a> -->
					<h1 style="color:black;">讲座查询</h1>
				</div>
				<div id='searchBox'>
					<input type="text" id="input"/>
					<div id="search">
						<button onclick="search()">
							点击搜索
						</button>
					</div>
				</div>
				<div id="activity">
					<script id="act-template" type="text/x-dot-template">
						{{ for(var i=0; i < it.length; i++) { }}
						<div class="item">
						<a tapmode="" onclick="openActDetail('{{=it[i].id}}');">
						<div class="pic" style="background-image:url({{=it[i].img.url}})">
						</div>
						<h2>{{=it[i].title}}</h2>
						<p>
						{{=it[i].summary}}
						</p>
						</a>
						</div>
						{{ } }}
					</script>
					<div id="act-content"></div>
				</div>
			</div>
		</div>
	</body>
	<script type="text/javascript" src="../script/api.js"></script>
	<script type="text/javascript" src="../script/doT.min.js"></script>
	<script type="text/javascript" src="../script/common.js"></script>
	<script type="text/javascript">
		function search() {
			var a = $api.byId('input');
			var input = $api.val(a);
			api.showProgress({
				title : '加载中...',
				modal : false
			});
			//  var urlParam = {}, whereParam = {};
			//  whereParam['like']= '台湾';
			//  whereParam['title']=whereParam;
			//  urlParam['where'] = whereParam;
			urlParam = {
				"where" : {
					"title" : {
						"like" : input
					}
				}
			}
			var getActivityUrl = '/activity?filter=';
			ajaxRequest(getActivityUrl + JSON.stringify(urlParam), 'GET', '', function(ret, err) {
				if (ret) {
					var content = $api.byId('act-content');
					var tpl = $api.byId('act-template').text;
					var tempFn = doT.template(tpl);
					content.innerHTML = tempFn(ret);
					api.parseTapmode();
				} else {
					api.toast({
						msg : err.msg,
						location : 'middle'
					})
				}
				api.hideProgress();
			})
		};
		function openActDetail(did) {
			api.openWin({
				name : 'actDetail',
				url : 'actDetail.html',
				//		delay: 200,
				pageParam : {
					dataId : did
				}
			});
		};
		apiready = function() {
			var header = $api.byId('header');
			$api.fixStatusBar(header);
		};
	</script>
</html>